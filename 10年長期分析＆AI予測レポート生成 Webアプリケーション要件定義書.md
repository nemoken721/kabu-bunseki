10年長期分析＆AI予測レポート生成 Webアプリケーション要件定義書
作成日: 2025年12月25日
版数: v3.0 (Major Update)
コンセプト: 過去10年のファンダメンタルズと株価の相関を解明し、未来のシナリオを提示する。
1. プロジェクト概要
1.1 目的・ゴール
* 長期トレンド把握: 景気サイクル（通常7〜10年）を含む過去10年分のデータを可視化し、企業の長期的な成長力や不況耐性を評価可能にする。
* 未来予測の自動化: 膨大な過去データと株価の動きをAIが分析し、「なぜ株価が動いたか」の根拠と共に、今後のシナリオレポートをワンクリックで出力する。
1.2 ターゲット
* 機関投資家レベルの分析を求める個人投資家
* 企業の長期経営分析を行うコンサルタント・研究者
2. システム構成図（ハイブリッドデータソース）
EDINET（財務）と市場データ（株価）を統合し、LLM（AI）で解釈する構成になります。


コード スニペット




graph TD
   User[ユーザー] -- 1.銘柄検索 --> FE[フロントエンド]
   FE -- 2.分析実行 --> BE[バックエンド]
   
   subgraph データ収集基盤
   BE -- 3.財務データ(10年分) --> EDINET[EDINET API]
   BE -- 4.株価データ(10年分) --> MktData[Stooq / Yahoo!ファイナンス]
   end
   
   subgraph データ処理・AI
   EDINET & MktData --> DataMerge[データ統合・正規化]
   DataMerge --> DB[(データベース)]
   
   DB -- 5.統合データ(財務+株価) --> LLM_Engine[生成AI (GPT-4等)]
   LLM_Engine -- 6.予測レポート生成 --> BE
   end
   
   BE -- 7.ダッシュボード/レポート --> FE

3. 機能要件
3.1 データ取得機能（期間拡張）
ID
	機能名
	詳細仕様
	F-01
	10年分財務データ取得
	指定銘柄の有価証券報告書を過去10年分（または取得可能な最大年数）遡って取得し、XBRL解析を行う。
	F-02
	長期株価データ取得
	外部API（pandas-datareader経由のStooq等）を使用し、同期間（10年分）の日足・週足株価データを取得する。
	F-03
	会計基準変更対応
	10年の間に「日本基準」から「IFRS」へ移行した企業の場合、接続可能な範囲でデータを正規化する（※完全接続不可の場合はグラフ上で区切り線を表示）。
	3.2 ダッシュボード表示機能（UI/UX）
ID
	機能名
	詳細仕様
	F-04
	年度選択スライダー
	画面上部に「2015年〜2024年」のようなスライダー（またはドロップダウン）を配置。選択した年度に応じて、下部の詳細情報エリアの内容を即座に切り替える。
	F-05
	年度別詳細表示
	選択された年度の「PL（損益計算書）」「BS（貸借対照表）」「CF（キャッシュフロー）」および「当時のトピック（有報のMD&A要約）」を表示する。
	F-06
	相関チャート
	10年間の「株価チャート」に重ねて、「売上高」「営業利益」の推移を折れ線グラフで描画。「業績発表のタイミングで株価がどう動いたか」を視覚化する。
	3.3 AI分析・レポート機能（核心機能）
ID
	機能名
	詳細仕様
	F-07
	分析実行ボタン
	画面内に目立つように「AI分析レポートを作成」ボタンを配置。押下時にローディングアニメーションを表示（処理時間：10〜30秒想定）。
	F-08
	特徴・予測レポート生成
	以下のプロンプト構成でLLMに分析させる。


1. 過去分析: 「業績（売上・利益）と株価の連動性が高いか、それとも乖離しているか（期待先行型か）」を分析。


2. 特徴抽出: 「どのようなニュース・決算数値が出た時に株価が跳ねる傾向があるか」を特定。


3. 未来予測: 直近の業績トレンドに基づき、向こう1〜3年の株価シナリオ（強気・弱気・レンジ）を提示。


4. 根拠: 上記予測に至った数値的根拠（例：「過去10年、営業利益率が10%を超えた翌年は株価が平均20%上昇しているため」）を提示。
	4. 画面レイアウト設計（ワイヤーフレーム案）


Plaintext




+-------------------------------------------------------+
|  [検索窓] 7203 トヨタ自動車                           |
+-------------------------------------------------------+
|  【メインチャートエリア（10年固定表示）】             |
|   [ 株価と営業利益の推移グラフ (2015-2025)      ]     |
|   [===========================================]     |
+-------------------------------------------------------+
|  【年度コントロール】                                 |
|   <  [ 2024年 (最新) ]  >  ▼詳細を表示                |
+-------------------------------------------------------+
|  【詳細情報エリア（選択年度のデータ）】               |
|  | 売上高: 45兆円 | 営業利益: 5.3兆円 | ROE: 15% |  |
|  |----------------------------------------------|  |
|  | [当時の経営課題要約]                         |  |
|  | ・円安効果による増益...                      |  |
+-------------------------------------------------------+
|                                                       |
|        [ ★ AI分析レポートを作成する ] (Action Btn)    |
|                                                       |
+-------------------------------------------------------+
|  【分析レポート出力エリア（ボタン押下後に展開）】     |
|  ### 株価推移の特徴                                   |
|  「当銘柄は、為替レートとの相関が0.8と非常に高く...」 |
|                                                       |
|  ### 今後の予測シナリオ                               |
|  「強気シナリオ: 株価 4,000円到達の可能性」           |
|  [根拠] 過去10年のPERレンジ下限にあり、割安感が...    |
+-------------------------------------------------------+

5. データベース設計（追加分）
10年分のデータを高速に扱うため、単純なAPI都度取得ではなく、DB保存が前提となります。
* StockPrices Table:
   * company_id
   * date (日付)
   * close_price (終値)
   * volume (出来高)
   * ※週次または月次データでデータ量を圧縮することを推奨。
* AnalysisReports Table:
   * company_id
   * analyzed_at (分析実行日時)
   * report_content (Markdown形式のAI生成テキスト)
   * ※一度生成したレポートはキャッシュし、APIコストを削減する。
6. 実装上の技術的課題と解決策
6.1 トークン量の増大
* 課題: 10年分の財務データと株価データをすべてLLMのプロンプトに入れると、コンテキストウィンドウ（文字数制限）を圧迫し、コストも高額になる。
* 解決策: 生データをすべて渡すのではなく、Python側で事前に**「特徴量エンジニアリング」**を行う。
   * 例：「10年間の平均成長率」「最高益との乖離率」「株価と利益の相関係数」などを計算し、その**計算結果（サマリ）**をLLMに渡すことで、少ないトークンで精度の高い分析をさせる。
6.2 10年前のデータの欠損
* 課題: EDINET API v2で取得できるのは原則5年分（法的保存期間）。それ以前のデータは取得できない場合や、API仕様が異なる場合がある。
* 解決策:
   * 仕様上の妥協: 「最大取得可能期間（最低5年、最大10年）」とし、取得できた期間だけで分析を行う仕様とする。
   * 代替手段: 上場企業であれば、古いデータもTDnet等のアーカイブに残っている可能性があるが、難易度が高いため、初期リリースでは「EDINETで取れる範囲」とするのが現実的。
6.3 投資助言に該当するリスク
* リスク: 「株価は上がります」と断定すると、投資助言業の違反になるリスクがある。
* 対策:
   * 出力文言の末尾に必ず「※本レポートはAIによる過去データの統計的分析であり、将来の成果を保証するものではありません」という免責事項を自動付与する。
   * 表現を「〜になります」ではなく「〜となる可能性があります」「過去の傾向からは〜と示唆されます」という推測表現に統一するようシステムプロンプト（AIへの指令）で制御する。
________________
